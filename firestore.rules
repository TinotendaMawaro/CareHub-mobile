rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Helper function to check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Caregivers collection
    match /caregivers/{caregiverId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && request.auth.uid == caregiverId;
    }

    // Parents collection
    match /parents/{parentId} {
      allow read, write: if isAuthenticated() && request.auth.uid == parentId;
    }

    // Clients collection
    match /clients/{clientId} {
      allow read, write: if isAuthenticated() && resource.data.assignedCaregiver == request.auth.uid;
    }

    // Bookings collection
    match /bookings/{bookingId} {
      allow read, write: if isAuthenticated() &&
        (resource.data.caregiverId == request.auth.uid || resource.data.parentId == request.auth.uid);
    }

    // Incidents collection
    match /incidents/{incidentId} {
      allow read, write: if isAuthenticated() && resource.data.caregiverId == request.auth.uid;
    }

    // Shifts collection
    match /shifts/{shiftId} {
      allow read, write: if isAuthenticated();  // Assuming authenticated users can manage shifts, but ideally check assignment
    }
  }
}